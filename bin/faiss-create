#!/usr/bin/env python3
from sys import argv, stdin
from faiss import index_factory, write_index
from numpystring import to_array


def main():
    string = argv[1]
    filepath = argv[2]
    index = None
    for line in stdin:
        array = to_array(line)
        if index is None:
            dims = array.shape[-1]
            index = index_factory(dims, string)
        index.add(array)  # pylint: disable=no-value-for-parameter
    write_index(index, filepath)


if __name__ == "__main__":
    main()

#!/usr/bin/env python3
from sys import stdin, argv
from pathlib import Path
from pandas import DataFrame


def main():
    columns = argv[1:]
    for directory in stdin:
        directory = Path(directory.strip())
        dataframe = DataFrame(list(get(columns, directory)), columns=columns)
        filepath = directory.with_suffix(".csv")
        dataframe.to_csv(filepath, index=False)
        print(filepath)


def get(columns, directory):
    pattern = "/".join(["*"] * (len(columns)))
    filepaths = list(directory.glob(pattern))
    for filepath in filepaths:
        with open(filepath, "r", encoding="utf-8") as file:
            items = list(map(strip, file.readlines()))
        keys = list(filepath.parts[-len(columns) : -1])  # noqa: E203
        for item in items:
            yield keys + [item]


def strip(line):
    return line.strip()


if __name__ == "__main__":
    main()
